<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Portail Chef des ventes ‚Äì MF Auto Sud</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="./assets/logo-mfautosud.png">
  <style>
    :root{
      --bg:#0b1220; --panel:#111c34; --panel2:#0f1a32;
      --text:#ffffff; --muted:rgba(255,255,255,.75); --line:rgba(255,255,255,.10);
      --brand:#4da3ff; --btn:#4da3ff; --btnText:#001; --btn2:#334155;
      --shadow: 0 10px 24px rgba(0,0,0,.22);
      --fieldBg: rgba(11,18,32,.85); --fieldBorder: rgba(255,255,255,.14); --fieldFocus: rgba(77,163,255,.55);
      --rowBg: rgba(11,18,32,.60); --rowBorder: rgba(255,255,255,.08);
      --msgBg: rgba(11,18,32,.75);
      --fileBg:#334155; --fileBorder: rgba(255,255,255,.10);
      --topbarBg: rgba(17,28,52,.85); --topbarBorder: rgba(255,255,255,.08);
      --chipBg: rgba(77,163,255,.12); --chipBorder: rgba(77,163,255,.25); --chipText: #cfe6ff;
      --divider: rgba(255,255,255,.10);
      --link: #7cc0ff;
    }
    [data-theme="light"]{
      --bg:#f6f8fc; --panel:#ffffff; --panel2:#ffffff;
      --text:#0b1220; --muted:rgba(15,23,42,.72); --line:rgba(15,23,42,.12);
      --brand:#2563eb; --btn:#2563eb; --btnText:#fff; --btn2:#e2e8f0;
      --shadow: 0 10px 24px rgba(2,6,23,.08);
      --fieldBg: rgba(255,255,255,.95); --fieldBorder: rgba(15,23,42,.14); --fieldFocus: rgba(37,99,235,.45);
      --rowBg: rgba(2,6,23,.03); --rowBorder: rgba(2,6,23,.08);
      --msgBg: rgba(2,6,23,.03);
      --fileBg: rgba(2,6,23,.06); --fileBorder: rgba(2,6,23,.10);
      --topbarBg: rgba(255,255,255,.85); --topbarBorder: rgba(2,6,23,.10);
      --chipBg: rgba(37,99,235,.10); --chipBorder: rgba(37,99,235,.22); --chipText: rgba(15,23,42,.85);
      --divider: rgba(2,6,23,.10);
      --link: #2563eb;
    }

    *{box-sizing:border-box}
    body{
      margin:0; font-family:Arial, sans-serif; color:var(--text); padding:24px;
      background:
        radial-gradient(1100px 460px at 10% -10%, rgba(77,163,255,.22), transparent 60%),
        radial-gradient(900px 380px at 90% 0%, rgba(37,99,235,.18), transparent 60%),
        var(--bg);
    }
    .wrap{max-width:1100px;margin:0 auto}

    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px 16px; border-radius:16px;
      background: var(--topbarBg); border:1px solid var(--topbarBorder);
      backdrop-filter: blur(6px); margin-bottom:16px; box-shadow: var(--shadow);
    }
    .brand{display:flex;align-items:center;gap:12px;min-width:0;}
    .brandLogo{
      width:44px;height:44px;border-radius:12px; background:var(--panel2); border:1px solid var(--line);
      display:flex;align-items:center;justify-content:center; padding:6px; flex:0 0 auto;
    }
    .brandLogo img{max-width:100%;max-height:100%;object-fit:contain;display:block}
    .brandTitle h1{font-size:16px;margin:0;color:var(--brand);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .brandTitle .sub{margin:2px 0 0;font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .topbarRight{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end;}
    .chip{
      font-size:12px; padding:6px 10px;border-radius:999px;
      background:var(--chipBg); border:1px solid var(--chipBorder); color:var(--chipText);
      white-space:nowrap;
    }

    .box{
      background: linear-gradient(180deg, rgba(17,28,52,.95), rgba(15,26,50,.95));
      border:1px solid rgba(255,255,255,.08);
      padding:16px; border-radius:16px; margin-bottom:14px; box-shadow: var(--shadow);
    }
    [data-theme="light"] .box{
      background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.92));
      border:1px solid rgba(2,6,23,.10);
    }

    h2{margin:0 0 10px;font-size:16px}
    h3{margin:10px 0 8px;font-size:14px}
    label{display:block;margin-top:10px;font-size:13px;color:var(--muted)}
    input,textarea{
      width:100%; padding:10px 12px; border-radius:12px;
      border:1px solid var(--fieldBorder); background:var(--fieldBg); color:var(--text); outline:none;
    }
    input:focus,textarea:focus{border-color:var(--fieldFocus); box-shadow:0 0 0 4px rgba(77,163,255,.12)}
    [data-theme="light"] input:focus,[data-theme="light"] textarea:focus{box-shadow:0 0 0 4px rgba(37,99,235,.12)}

    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
    button{
      padding:10px 12px; border-radius:12px; border:0;
      background:var(--btn); color:var(--btnText); font-weight:800; cursor:pointer;
      transition:.12s transform ease, .12s opacity ease;
    }
    button:hover{transform: translateY(-1px)}
    button:active{transform: translateY(0px); opacity:.92}
    button.secondary{
      background:var(--btn2); color: var(--text); font-weight:700; border:1px solid var(--line);
    }
    [data-theme="light"] button.secondary{color:#0b1220;border:1px solid rgba(2,6,23,.10)}
    button.small{padding:8px 10px;border-radius:12px;margin-top:0}

    .hint{opacity:.86;font-size:12px;margin-top:8px;white-space:pre-wrap;line-height:1.35;color:var(--muted)}
    .divider{height:1px;background:var(--divider);margin:14px 0}
    a{color:var(--link)}

    .providerRow{
      display:flex;align-items:center;gap:10px;
      padding:10px 10px;border-radius:14px;
      background:var(--rowBg);
      border:1px solid var(--rowBorder);
      margin:8px 0;
      min-height:46px;
    }
    .providerRow input{margin-top:0}
    .providerRow .txt{
      flex:1; min-width:0;
      display:flex; flex-direction:column; justify-content:center;
    }
    .providerRow .main{
      display:block; font-size:13px; font-weight:800; color:var(--text);
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .providerRow .sub{
      display:block; margin-top:2px; font-size:12px; font-weight:600; color:var(--muted);
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }

    .msg{background:var(--msgBg); padding:12px; border-radius:14px; margin-top:10px; border:1px solid var(--rowBorder)}
    .msg.you{border-left:4px solid var(--brand)}
    .msg.them{border-left:4px solid #22c55e}
    .msgHead{display:flex;gap:10px;align-items:center;justify-content:space-between}
    .msgMeta{font-size:12px;opacity:.75;color:var(--muted)}
    .msgWho{font-weight:800}
    .msgBody{margin-top:8px;line-height:1.45;font-size:13px}

    .file{
      display:inline-block; margin-top:8px; padding:8px 10px; border-radius:12px;
      background:var(--fileBg); color:var(--text); text-decoration:none; border:1px solid var(--fileBorder);
    }
    .thumb{
      margin-top:8px;
      max-width:260px;
      border-radius:12px;
      border:1px solid var(--fileBorder);
      display:block;
    }

    .card{background:var(--rowBg); border:1px solid var(--rowBorder); border-radius:16px; padding:14px;}
    .gridInfo{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:720px){.gridInfo{grid-template-columns:1fr}}
    .kv{padding:10px 10px;border-radius:14px;background:rgba(17,28,52,.35);border:1px solid var(--rowBorder);}
    [data-theme="light"] .kv{background:rgba(2,6,23,.03)}
    .kv b{display:block;font-size:12px;opacity:.8;margin-bottom:4px}
    .kv div{font-size:13px;word-break:break-word}
    /* ============ iMessage-like chat ============ */
.msg{
  background: transparent;
  border: 0;
  padding: 0;
  margin-top: 10px;
}

.msgRow{
  display:flex;
  width:100%;
}

.msgRow.you{ justify-content:flex-end; }
.msgRow.them{ justify-content:flex-start; }

.bubble{
  max-width: 78%;
  padding: 10px 12px;
  border-radius: 18px;
  border: 1px solid var(--rowBorder);
  background: var(--msgBg);
  box-shadow: 0 6px 16px rgba(0,0,0,.10);
}

.msgRow.you .bubble{ border-bottom-right-radius: 8px; }
.msgRow.them .bubble{ border-bottom-left-radius: 8px; }

.bubbleHead{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:6px;
}

.bubbleWho{
  font-size:12px;
  font-weight:800;
  opacity:.9;
}

.bubbleMeta{
  font-size:11px;
  opacity:.7;
  color: var(--muted);
  white-space:nowrap;
}

.bubbleBody{
  font-size:13px;
  line-height:1.45;
  word-break:break-word;
}
  </style>
</head>

<body>
<div class="wrap">
  <div class="topbar">
    <div class="brand">
      <div class="brandLogo">
        <img src="./assets/logo-mfautosud.png" alt="MF Auto Sud">
      </div>
      <div class="brandTitle">
        <h1>Portail Chef des ventes</h1>
        <div class="sub">Attribuer ‚Ä¢ G√©rer vendeurs ‚Ä¢ R√©pondre ‚Ä¢ Pi√®ces jointes</div>
      </div>
    </div>
    <div class="topbarRight">
      <div class="chip" id="modeChip">Chef des ventes</div>
      <div class="chip" id="newMsgChip" style="display:none;">üîî Nouveau message</div>
      <button class="secondary" id="themeBtn" type="button">üåô Mode sombre</button>
    </div>
  </div>

  <div class="box">
    <h2>Dossier</h2>
    <div class="row">
      <button class="secondary" id="refreshBtn" type="button">üîÑ Rafra√Æchir</button>
      <button class="secondary" id="copyLinkBtn" type="button">Copier le lien</button>
      <button class="secondary" id="markReadBtn" type="button">‚úÖ Marquer comme lu</button>
    </div>
    <div id="requestInfo" class="hint" style="margin-top:10px">Chargement‚Ä¶</div>
    <div id="accessErr" class="hint" style="margin-top:10px;display:none;"></div>
  </div>

  <div class="box" id="assignBox" style="display:none;">
    <h2>Attribuer √† un vendeur</h2>
    <div id="assignHint" class="hint">Chargement‚Ä¶</div>
    <div id="assignList" style="margin-top:10px"></div>
    <div class="row">
      <button class="secondary" id="assignBtn" type="button">Attribuer</button>
      <button class="secondary" id="reloadVendorsBtn" type="button">üîÑ Recharger vendeurs</button>
    </div>
    <div id="assignStatus" class="hint"></div>

    <div class="divider"></div>

    <h3>Gestion des vendeurs</h3>
    <div class="gridInfo" style="margin-top:10px">
      <div>
        <label>Email vendeur</label>
        <input id="mgrVendorEmail" placeholder="vendeur@domaine.com">
      </div>
      <div>
        <label>Nom vendeur (optionnel)</label>
        <input id="mgrVendorName" placeholder="Pr√©nom Nom">
      </div>
    </div>
    <div class="row">
      <button id="mgrAddVendorBtn" type="button">‚ûï Ajouter vendeur</button>
      <button class="secondary" id="mgrRemoveVendorBtn" type="button">üóëÔ∏è Supprimer vendeur</button>
    </div>
    <div id="mgrVendorStatus" class="hint"></div>
  </div>

  <div class="box">
    <h2>Conversation</h2>
    <div id="thread" style="margin-top:10px"></div>
  </div>

  <div class="box">
    <h2>R√©pondre</h2>
    <label>Message</label>
    <textarea id="respMsg" style="height:120px" placeholder="Votre message‚Ä¶"></textarea>

    <label>Documents (PDF, images‚Ä¶)</label>
<input type="file" id="respFiles" multiple accept="application/pdf,image/*">
    <div class="row">
      <button id="sendMsgBtn" type="button">Envoyer</button>
    </div>
    <div id="respStatus" class="hint"></div>
  </div>

  <div class="box" id="debugBox" style="display:none;">
    <h2>Debug</h2>
    <div id="debugOut" class="hint">‚Äî</div>
    <div class="row"><button class="secondary" id="debugClearBtn" type="button">Vider</button></div>
  </div>
</div>

<script>
/* ========================= CONFIG ========================= */
const SUPABASE_URL = "https://tubhsjkstbrqlvmylobz.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR1YmhzamtzdGJycWx2bXlsb2J6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0MDE1NzQsImV4cCI6MjA4NDk3NzU3NH0.tANS4zo9wvLsWJS48Hyw6thttQX0yhBjOKI1aY4FTCo";

<!-- ... (fichier complet identique √† celui pr√©sent dans le d√©p√¥t) ... -->
</script>
</body>
</html>
